generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

model NotificationGroup {
  id          String   @id
  name        String   @unique
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  color       String?
  icon        String?
  users       users[]  @relation("NotificationGroupMembers")
}

model approval_logs {
  id                  String            @id
  approval_request_id String
  action              String
  old_value           Json?
  new_value           Json?
  actor_id            String
  actor_name          String
  actor_role          String
  remark              String?
  ip_address          String?
  user_agent          String?
  created_at          DateTime          @default(now())
  approval_requests   approval_requests @relation(fields: [approval_request_id], references: [id], onDelete: Cascade)

  @@index([actor_id])
  @@index([approval_request_id])
}

model approval_requests {
  id                                          String          @id
  reason                                      String?
  status                                      ApprovalStatus  @default(PENDING)
  requester_id                                String
  approver_id                                 String?
  submitted_at                                DateTime        @default(now())
  acted_at                                    DateTime?
  action_type                                 String
  current_data                                Json?
  deleted_at                                  DateTime?
  deleted_by                                  String?
  entity_id                                   String
  entity_type                                 String
  expires_at                                  DateTime?
  priority                                    String          @default("NORMAL")
  proposed_data                               Json?
  remark                                      String?
  request_type                                String
  source_app                                  String
  users_approval_requests_approver_idTousers  users?          @relation("approval_requests_approver_idTousers", fields: [approver_id], references: [id])
  users_approval_requests_requester_idTousers users           @relation("approval_requests_requester_idTousers", fields: [requester_id], references: [id])
  approval_logs                               approval_logs[]

  @@index([approver_id])
  @@index([entity_type, entity_id])
  @@index([requester_id])
  @@index([status])
}

model book_views {
  id              String          @id
  book_id         String
  user_id         String
  viewed_at       DateTime        @default(now())
  knowledge_books knowledge_books @relation(fields: [book_id], references: [id], onDelete: Cascade)
  users           users           @relation(fields: [user_id], references: [id])

  @@index([book_id])
  @@index([user_id])
}

model booking_lab_samples {
  id              String   @id
  booking_id      String
  sample_no       Int
  is_trailer      Boolean  @default(false)
  before_press    Float?
  basket_weight   Float?
  cuplump_weight  Float?
  after_press     Float?
  percent_cp      Float?
  before_baking_1 Float?
  before_baking_2 Float?
  before_baking_3 Float?
  created_at      DateTime @default(now())
  updated_at      DateTime
  p0              Float?
  p30             Float?
  pri             Float?
  bookings        bookings @relation(fields: [booking_id], references: [id], onDelete: Cascade)
}

model bookings {
  id                    String                @id
  queue_no              Int
  booking_code          String                @unique
  date                  DateTime
  start_time            String
  end_time              String
  slot                  String?
  supplier_id           String
  supplier_code         String
  supplier_name         String
  truck_type            String?
  truck_register        String?
  rubber_type           String
  recorder              String
  checkin_at            DateTime?
  created_at            DateTime              @default(now())
  updated_at            DateTime
  deleted_at            DateTime?
  deleted_by            String?
  note                  String?
  rubber_source         String?
  start_drain_at        DateTime?
  stop_drain_at         DateTime?
  trailer_rubber_source String?
  trailer_rubber_type   String?
  trailer_weight_in     Float?
  trailer_weight_out    Float?
  weight_in             Float?
  weight_out            Float?
  drain_note            String?
  approved_at           DateTime?
  approved_by           String?
  status                String                @default("PENDING")
  checked_in_by         String?
  start_drain_by        String?
  stop_drain_by         String?
  weight_in_by          String?
  weight_out_by         String?
  lot_no                String?
  drc_actual            Float?
  drc_est               Float?
  drc_requested         Float?
  moisture              Float?
  estimated_weight      Float?
  trailer_drc_actual    Float?
  trailer_drc_est       Float?
  trailer_drc_requested Float?
  trailer_lot_no        String?
  trailer_moisture      Float?
  booking_lab_samples   booking_lab_samples[]

  @@index([booking_code])
  @@index([date, slot])
  @@index([deleted_at])
}

model districts {
  id           Int            @id
  code         String         @unique
  name_th      String
  name_en      String
  province_id  Int
  created_at   DateTime       @default(now())
  provinces    provinces      @relation(fields: [province_id], references: [id])
  subdistricts subdistricts[]
  suppliers    suppliers[]
}

model it_assets {
  id            String       @id
  code          String       @unique
  name          String
  category      String
  stock         Int          @default(0)
  min_stock     Int          @default(2)
  location      String?
  description   String?
  image         String?
  price         Float?       @default(0)
  received_date DateTime     @default(now())
  receiver      String?
  created_at    DateTime     @default(now())
  updated_at    DateTime
  serial_number String?
  barcode       String?
  it_tickets    it_tickets[]
}

model it_tickets {
  id                                   String            @id
  ticket_no                            String            @unique
  title                                String
  description                          String?
  category                             String
  priority                             String            @default("Medium")
  status                               String            @default("Open")
  requester_id                         String
  assignee_id                          String?
  created_at                           DateTime          @default(now())
  updated_at                           DateTime
  location                             String?
  approver_id                          String?
  asset_id                             String?
  expected_date                        DateTime?
  is_asset_request                     Boolean           @default(false)
  issued_at                            DateTime?
  issued_by                            String?
  quantity                             Int?              @default(0)
  it_assets                            it_assets?        @relation(fields: [asset_id], references: [id])
  users_it_tickets_assignee_idTousers  users?            @relation("it_tickets_assignee_idTousers", fields: [assignee_id], references: [id])
  users_it_tickets_requester_idTousers users             @relation("it_tickets_requester_idTousers", fields: [requester_id], references: [id])
  ticket_comments                      ticket_comments[]

  @@index([asset_id])
  @@index([assignee_id])
  @@index([requester_id])
  @@index([status])
}

model knowledge_books {
  id            String       @id
  title         String
  description   String?
  category      String
  file_type     String
  file_path     String
  file_name     String
  file_size     Int
  cover_image   String?
  author        String?
  uploaded_by   String
  views         Int          @default(0)
  downloads     Int          @default(0)
  tags          String[]
  is_published  Boolean      @default(true)
  training_date DateTime?
  attendees     Int?         @default(0)
  created_at    DateTime     @default(now())
  updated_at    DateTime
  users         users        @relation(fields: [uploaded_by], references: [id])
  book_views    book_views[]

  @@index([category])
  @@index([is_published])
  @@index([uploaded_by])
}

model machines {
  id          String        @id
  name        String        @unique
  model       String?
  location    String?
  status      String        @default("Active")
  created_at  DateTime      @default(now())
  updated_at  DateTime
  repair_logs repair_logs[]
}

model notification_settings {
  id              String   @id
  sourceApp       String
  actionType      String
  isActive        Boolean  @default(true)
  recipientRoles  Json     @default("[]")
  recipientUsers  Json     @default("[]")
  channels        Json     @default("[\"IN_APP\"]")
  created_at      DateTime @default(now())
  updated_at      DateTime
  recipientGroups Json     @default("[]")

  @@unique([sourceApp, actionType])
}

model notifications {
  id                  String             @id
  title               String
  message             String
  type                NotificationType   @default(INFO)
  status              NotificationStatus @default(UNREAD)
  user_id             String
  sourceApp           String
  actionType          String
  entityId            String?
  actionUrl           String?
  metadata            Json?
  created_at          DateTime           @default(now())
  approval_request_id String?
  approval_status     String?
  users               users              @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([approval_request_id])
  @@index([user_id])
}

model posts {
  id        String   @id
  title     String
  content   String?
  published Boolean  @default(false)
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime
  users     users    @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([authorId])
}

model printer_departments {
  id                    String                  @id
  name                  String                  @unique
  description           String?
  created_at            DateTime                @default(now())
  updated_at            DateTime
  printer_usage_records printer_usage_records[]
  printer_user_mappings printer_user_mappings[]
}

model printer_usage_records {
  id                  String               @id
  period              DateTime
  user_name           String
  department_id       String?
  print_bw            Int                  @default(0)
  print_color         Int                  @default(0)
  copy_bw             Int                  @default(0)
  copy_color          Int                  @default(0)
  total               Int                  @default(0)
  created_at          DateTime             @default(now())
  updated_at          DateTime
  serial_no           String               @default("unknown")
  printer_departments printer_departments? @relation(fields: [department_id], references: [id])

  @@unique([period, user_name, serial_no])
}

model printer_user_mappings {
  id                  String              @id
  user_name           String              @unique
  department_id       String
  created_at          DateTime            @default(now())
  updated_at          DateTime
  printer_departments printer_departments @relation(fields: [department_id], references: [id], onDelete: Cascade)
}

model provinces {
  id         Int         @id
  code       String      @unique
  name_th    String
  name_en    String
  created_at DateTime    @default(now())
  districts  districts[]
  suppliers  suppliers[]
}

model repair_logs {
  id           String   @id
  machine_id   String
  machine_name String
  date         DateTime @default(now())
  issue        String
  technician   String
  parts        Json?    @default("[]")
  total_cost   Float    @default(0)
  created_at   DateTime @default(now())
  updated_at   DateTime
  machines     machines @relation(fields: [machine_id], references: [id], onDelete: Cascade)
}

model roles {
  id          String   @id
  name        String   @unique
  description String?
  icon        String?
  color       String?
  permissions String[]
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime
  users       users[]
}

model rubber_types {
  id          String    @id
  code        String    @unique
  name        String
  description String?
  category    String?
  is_active   Boolean   @default(true)
  created_at  DateTime  @default(now())
  updated_at  DateTime
  deleted_at  DateTime?
  deleted_by  String?

  @@index([deleted_at])
}

model subdistricts {
  id          Int         @id
  code        String      @unique
  name_th     String
  name_en     String
  zip_code    String?
  created_at  DateTime    @default(now())
  district_id Int
  districts   districts   @relation(fields: [district_id], references: [id])
  suppliers   suppliers[]
}

model suppliers {
  id                 String        @id
  code               String        @unique
  display_name       String
  tax_id             String?
  address            String?
  phone              String?
  email              String?
  province_id        Int?
  district_id        Int?
  subdistrict_id     Int?
  status             String        @default("ACTIVE")
  notes              String?
  rubber_type_codes  String[]
  created_at         DateTime      @default(now())
  updated_at         DateTime
  first_name         String?
  last_name          String?
  title              String?
  avatar             String?
  zip_code           String?
  certificate_number String?
  certificate_expire DateTime?
  score              Float?        @default(0)
  eudr_quota_used    Float?
  eudr_quota_current Float?
  contact_person     String?
  is_active          Boolean       @default(true)
  deleted_at         DateTime?
  deleted_by         String?
  districts          districts?    @relation(fields: [district_id], references: [id])
  provinces          provinces?    @relation(fields: [province_id], references: [id])
  subdistricts       subdistricts? @relation(fields: [subdistrict_id], references: [id])

  @@index([deleted_at])
}

model ticket_comments {
  id         String     @id
  content    String
  ticket_id  String
  user_id    String
  created_at DateTime   @default(now())
  it_tickets it_tickets @relation(fields: [ticket_id], references: [id], onDelete: Cascade)
  users      users      @relation(fields: [user_id], references: [id])

  @@index([ticket_id])
  @@index([user_id])
}

model user_app_permissions {
  id         String   @id
  user_id    String
  appName    String
  actions    Json
  created_at DateTime @default(now())
  updated_at DateTime
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, appName])
}

model users {
  id                                                      String                 @id
  email                                                   String                 @unique
  password                                                String
  createdAt                                               DateTime               @default(now())
  updatedAt                                               DateTime
  avatar                                                  String?
  department                                              String?
  display_name                                            String?
  first_name                                              String?
  hod_id                                                  String?
  last_name                                               String?
  pin_code                                                String?
  position                                                String?
  status                                                  UserStatus             @default(ACTIVE)
  username                                                String?                @unique
  role                                                    String                 @default("staff_1")
  employee_id                                             String?                @unique
  failed_login_attempts                                   Int                    @default(0)
  force_change_password                                   Boolean                @default(false)
  is_hod                                                  Boolean                @default(false)
  last_login_at                                           DateTime?
  manager_id                                              String?
  permissions                                             Json?                  @default("[]")
  preferences                                             Json?
  site                                                    String?
  role_id                                                 String?
  users_usersTousers_hod_id                               users?                 @relation("usersTousers_hod_id", fields: [hod_id], references: [id])
  users_usersTousers_manager_id                           users?                 @relation("usersTousers_manager_id", fields: [manager_id], references: [id])
  roles                                                   roles?                 @relation(fields: [role_id], references: [id])
  approval_requests_approval_requests_approver_idTousers  approval_requests[]    @relation("approval_requests_approver_idTousers")
  approval_requests_approval_requests_requester_idTousers approval_requests[]    @relation("approval_requests_requester_idTousers")
  book_views                                              book_views[]
  it_tickets_it_tickets_assignee_idTousers                it_tickets[]           @relation("it_tickets_assignee_idTousers")
  it_tickets_it_tickets_requester_idTousers               it_tickets[]           @relation("it_tickets_requester_idTousers")
  knowledge_books                                         knowledge_books[]
  notifications                                           notifications[]
  posts                                                   posts[]
  ticket_comments                                         ticket_comments[]
  user_app_permissions                                    user_app_permissions[]
  other_users_usersTousers_hod_id                         users[]                @relation("usersTousers_hod_id")
  other_users_usersTousers_manager_id                     users[]                @relation("usersTousers_manager_id")
  NotificationGroup                                       NotificationGroup[]    @relation("NotificationGroupMembers")
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  RETURNED
  EXPIRED
  VOID
}

enum NotificationStatus {
  UNREAD
  READ
  ARCHIVED
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  REQUEST
  APPROVE
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING
}
